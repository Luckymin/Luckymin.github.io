<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Activity的启动模式和匹配规则 | Min blog | Thought is already is late, exactly is the earliest time.</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="Android基础">
  <meta name="description" content="博文内容来自《Android开发艺术探索》第一章Activity的生命周期和启动模式。
Activity是四大组件中我们接触的最多的一个组件，它非常的重要，所以有必要搞清楚他的启动模式和匹配规则">
<meta property="og:type" content="article">
<meta property="og:title" content="Activity的启动模式和匹配规则">
<meta property="og:url" content="http://yoursite.com/2016/02/27/2016022717_Activity的启动模式和匹配规则/index.html">
<meta property="og:site_name" content="Min blog">
<meta property="og:description" content="博文内容来自《Android开发艺术探索》第一章Activity的生命周期和启动模式。
Activity是四大组件中我们接触的最多的一个组件，它非常的重要，所以有必要搞清楚他的启动模式和匹配规则">
<meta property="og:updated_time" content="2016-03-02T07:43:45.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Activity的启动模式和匹配规则">
<meta name="twitter:description" content="博文内容来自《Android开发艺术探索》第一章Activity的生命周期和启动模式。
Activity是四大组件中我们接触的最多的一个组件，它非常的重要，所以有必要搞清楚他的启动模式和匹配规则">
  
    <link rel="alternative" href="/atom.xml" title="Min blog" type="application/atom+xml">
  
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

<body>
  <div id="loading" class="active"></div>

  <nav id="menu" class="hide" >
   <div class="inner">
  <a href="javascript:;" class="header-icon waves-circle-light" id="menu-off">
      <i class="icon icon-lg icon-close"></i>
  </a>
  <div class="brand-wrap">
    <div class="brand">
      <a href="./" class="avatar"><img src="/img/logo.jpeg"></a>
      <hgroup class="introduce">
        <h5 class="nickname">花生牛奶巧克力</h5>
        <a href="mailto:undefined" title="kluckymin@gmail.com" class="mail">kluckymin@gmail.com</a>
      </hgroup>
    </div>
  </div>
  <ul class="nav">
    
        <li class="waves-block">
          <a href="/"  >
            <i class="icon icon-lg icon-home"></i>Home
          </a>
        </li>
    
        <li class="waves-block">
          <a href="/archives"  >
            <i class="icon icon-lg icon-archives"></i>Archives
          </a>
        </li>
    
        <li class="waves-block">
          <a href="/tags"  >
            <i class="icon icon-lg icon-tags"></i>Tags
          </a>
        </li>
    
        <li class="waves-block">
          <a href="https://github.com/Luckymin" target="_blank" >
            <i class="icon icon-lg icon-github"></i>Github
          </a>
        </li>
    
        <li class="waves-block">
          <a href="http://weibo.com/staringmake" target="_blank" >
            <i class="icon icon-lg icon-weibo"></i>Weibo
          </a>
        </li>
    
  </ul>

  <footer class="footer">
  <p><a rel="license" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0;vertical-align:middle;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAAllBMVEUAAAD///+rsapERER3d3eIiIjMzMzu7u4iIiKUmZO6v7rKzsoODg4RERFVVVUNDQ0NDg0PEA8zMzNLTEtbXltmZmZydnF9gn2AgICPkI+ZmZmqqqq7u7vFxsXIzMgNDQwZGRkgICAhISEkJSMnKCcuMC4xMzE5Ozk7PTtBQkFCQkJDQ0Nna2eGhoaHh4ezuLLGysbd3d1wVGpAAAAA4UlEQVR42q2T1xqCMAyFk7QsBQeKA9x7j/d/OSm22CpX0nzcpA1/T05aAOuBVkMAScQFHLnEwoCo2f1TnQIGoVMewjZEjVFN4GH1Ue1Cn2jWqwfsOOj6wDwGvotsl/c8lv7KIq1eLOsT0HMFHMIE/RZyHnlphryT9zyV+8WH5e8yQw3wnQvgAFxPTKUVi555SHR/lOfLMgVTeDlSfN+TaoUsiTyeIm+bCkHvCA2FUKG48LDtYBZBknsYP/G8NTw0gaaHyuQf4H5pecrB/FYCT2sL9zAfy1Xyjou6L8X2W7YcLyBZCRtnq/zfAAAAAElFTkSuQmCC" /></a></p>
  <p>Min blog &copy; 2017</p>
  <p>Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme
  <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a></p>
  <a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-2x icon-rss-square"></i></a>
</footer>

</div>

  </nav>
  <main id="main">
    <header class="header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-circle-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Activity的启动模式和匹配规则</div>
        <a href="javascript:;" class="header-icon waves-circle-light" id="menu-share">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
    </div>
</header>
<header class="content-header">
  <div class="container">
    <h1 class="author">Activity的启动模式和匹配规则</h1>
    <h5 class="subtitle">2016-02-27</h5>
  </div>
</header>

    <div class="container body-wrap">
      
  <article id="post-2016022717_Activity的启动模式和匹配规则" class="article article-type-post" itemscope itemprop="blogPost">
    
      <div class="post-meat flex-row">
        <div class="flex-col">
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android基础/">Android基础</a></li></ul>
</div>
      </div>
      <div class="post-body">

        <aside class="post-widget" id="post-widget">

          
          <div class="post-share" id="post-share" data-title="Activity的启动模式和匹配规则" data-pic="/img/logo.jpeg" data-summary="&lt;p&gt;&lt;strong&gt;博文内容来自《Android开发艺术探索》第一章Activity的生命周期和启动模式。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Activity是四大组件中我们接触的最多的一个组件，它非常的重要，所以有必要搞清楚他的启动模式和匹配规则&lt;/p&gt;" data-url="http://yoursite.com/2016/02/27/2016022717_Activity的启动模式和匹配规则/index.html">
    <div class="tit">分享到：</div>
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" href="javascript:;" data-title="微博" data-service="tsina">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns" href="javascript:;" data-title="微信" data-service="weixin">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" href="javascript:;" data-title=" QQ" data-service="cqq">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" href="javascript:;" data-title=" Facebook" data-service="fb">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" href="javascript:;" data-title=" Twitter" data-service="twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="douban share-sns" href="javascript:;" data-title="豆瓣" data-service="douban">
          豆
        </a>
      </li>
    </ul>
 </div>

          

          
          <nav class="post-toc-wrap" id="post-toc">
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u4E00_u3001Activity_u7684_u542F_u52A8_u6A21_u5F0F"><span class="post-toc-text">一、Activity的启动模式</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#standard"><span class="post-toc-text">standard</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#singleTop"><span class="post-toc-text">singleTop</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#singleTask"><span class="post-toc-text">singleTask</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#singleInstance"><span class="post-toc-text">singleInstance</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#u8865_u5145"><span class="post-toc-text">补充</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u4E8C_u3001Activity_u7684Flags"><span class="post-toc-text">二、Activity的Flags</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#FLAG_ACTIVITY_NEW_TASK"><span class="post-toc-text">FLAG_ACTIVITY_NEW_TASK</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#FLAG_ACTIVITY_SINGLE_TOP"><span class="post-toc-text">FLAG_ACTIVITY_SINGLE_TOP</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#FLAG_ACTIVITY_CLEAR_TOP"><span class="post-toc-text">FLAG_ACTIVITY_CLEAR_TOP</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u4E09_u3001IntentFilter_u7684_u5339_u914D_u89C4_u5219"><span class="post-toc-text">三、IntentFilter的匹配规则</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#action_u5339_u914D_u89C4_u5219"><span class="post-toc-text">action匹配规则</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#category_u7684_u5339_u914D_u89C4_u5219"><span class="post-toc-text">category的匹配规则</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#data_u7684_u5339_u914D_u89C4_u5219"><span class="post-toc-text">data的匹配规则</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#data_u7684_u8BED_u6CD5"><span class="post-toc-text">data的语法</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#data_u7684_u8FC7_u6EE4_u89C4_u5219"><span class="post-toc-text">data的过滤规则</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#u6700_u540E"><span class="post-toc-text">最后</span></a></li></ol></li></ol>
          </nav>
          
        </aside>

        <div class="post-main">

            <div class="post-content" itemprop="postContent"><p><strong>博文内容来自《Android开发艺术探索》第一章Activity的生命周期和启动模式。</strong></p>
<p>Activity是四大组件中我们接触的最多的一个组件，它非常的重要，所以有必要搞清楚他的启动模式和匹配规则</p>
<a id="more"></a>
<h2 id="u4E00_u3001Activity_u7684_u542F_u52A8_u6A21_u5F0F"><a href="#u4E00_u3001Activity_u7684_u542F_u52A8_u6A21_u5F0F" class="headerlink" title="一、Activity的启动模式"></a>一、Activity的启动模式</h2><p>目前有四种启动模式：standard、singleTop、singleTask和singleInstance。</p>
<h3 id="standard"><a href="#standard" class="headerlink" title="standard"></a>standard</h3><p>standard即标准模式，是Activity默认指定的模式，每一次启动Activity，都会重新创建一个实例,一个任务栈可以有多个实例，每个实例可以属于不同的栈。在这种模式下谁启动了这个Activity，那么这个Activity就会运行在启动它的Activity所在的栈中。所以让我们使用非Activity类型的Context去启动standard模式的Activity时候就会报错，因为非Activity类型的Context（如AppplicationContext）并没有所谓的任务栈。解决办法就是为待启动的Activity指定FLAG_ACTIVITY_NEW_TASK（singleTask模式）标记位，这样启动它的时候就会为它创建一个新的任务栈。</p>
<h3 id="singleTop"><a href="#singleTop" class="headerlink" title="singleTop"></a>singleTop</h3><p>singleTop栈顶复用模式即。在这模式下，如果新的Activity已经位于任务栈的栈顶，那么此Activity不会被重新创建，同时它的onNewIntent方法会被回调，通过此方法的参数我们可以去取出当前请求的的信息。需要注意的是，这个Activity的onCreate、onStart不会被调用，因为它没有发生改变。如果新的Activity的实例已存在但不位于栈顶，那么就会重新创建一个新的Activity。</p>
<h3 id="singleTask"><a href="#singleTask" class="headerlink" title="singleTask"></a>singleTask</h3><p>栈内复用模式。这是一种单实例模式，在这种模式下，只要Activity在一个栈中存在，那么多次启动此Activity都不会重新创建实例，和singleTop，系统也会回调其onNewIntent。具体一点，当一个具有singleTask模式的Activity请求启动后，比如Activity A，系统首先会寻找是否存在A想要的任务栈，如果不存在，就重新创建一个任务栈，然后创建A的实例后把A放入栈中。如果存在A所需要的任务栈，这是要看这个栈中是否存在A的实例，如果实例存在，那么就会将A调到栈顶，并调用onNewIntent方法，当然，由于任务栈是‘后进先出’的栈结构，系统需要先把A之上的Activity实例退出栈后才能将A调到栈顶，如果实例不存在，就创建A的实例并把A压入到栈中。</p>
<h3 id="singleInstance"><a href="#singleInstance" class="headerlink" title="singleInstance"></a>singleInstance</h3><p>单实例模式。这是一种加强的singleTask模式，它除了具有singleTask模式的所有特性外，还加强了一点，那就是具有此种模式的Activity只能单独地位于一个任务栈中，换句话说，比如Activity A是singleInstance模式，当A启动后，系统会为它建一个新的任务栈，然后A独自在这个新的栈中，由于栈内复用的特性，后续的请求均不会创建新的Activity，除非这个独特的任务栈被系统销毁了。</p>
<h3 id="u8865_u5145"><a href="#u8865_u5145" class="headerlink" title="补充"></a>补充</h3><ol>
<li><p>上面介绍了几种启动模式，这里需要指出一种情况，我们假设目前有2个任务栈， 前台任务栈的情况为AB，后台任务栈的情况为CD，假设CD的启动模式为singleTask。现在请求启动D，那么整个后台任务栈会被切换到前台，这个时候整个后退列表变成了ABCD，如果启动C，就会变为ABC了</p>
</li>
<li><p>在singleTask启动模式中，多次提到Activity所需要的任务栈，什么事Activity所需要的任务栈呢？这要从一个参数说起：TaskAffinity，这个参数标识了一个Activity所需要的任务栈的名字，默认情况下，所有Activity所需要的任务栈的名字为应用的包名相同。当然，我们可以为每个Activity单独指定TaskAffinity属性，这个属性不能和名相同，否则就相当于没有指定。TaskAffinity属性主要和singleTask启动模式或者allowTaskReparenting属性配对使用，在其他情况下没有意义。另外，任务栈分为前台任务栈和后台任务栈，后台任务栈的Activity位于暂停状态，用户可以通过切换将后台任务栈再次调到前台。</p>
</li>
<li><p>当TaskAffinity和singleTask启动模式配对使用的时候，它是具有该模式的Activity的目前任务栈的名字，待启动的Activity会运行在名字和TaskAffinity相同任务栈中。</p>
</li>
<li><p>当TaskAffinity和allowTaskReparenting结合的时候，会产生特殊的效果。当一个应用A启动应用B的某个Activity后，如果这个Activity的allowTaskReparenting属性为true的话，那么当应用B被启动后，此Activity会直接从应用的任务栈转移到应用B的任务栈中</p>
</li>
<li><p>如何给Activity指定启动模式呢？有下面两种方式</p>
<ul>
<li>通过AndroidMenifest为Activity指定启动模式，这种方式直接为Activity设置FLAG_ACTIVITY_CLEAR_TOP标识</li>
<li>通过Intent中设置标志位来为Activity指定启动模式。这种方式无法为Activity指定singleInstance模式</li>
</ul>
</li>
</ol>
<h2 id="u4E8C_u3001Activity_u7684Flags"><a href="#u4E8C_u3001Activity_u7684Flags" class="headerlink" title="二、Activity的Flags"></a>二、Activity的Flags</h2><p>Activitry的Flag有很多，这里主要分析一些比较常用的标记为。剩下的标记位读者可以查看官方文档去了解，大部分情况下，我们不需要为Activity指定标记位，因此，对于标记位理解即可。需要注意有些标记位是系统内部使用的，应用程序不需要去手动设置这些标记位</p>
<h3 id="FLAG_ACTIVITY_NEW_TASK"><a href="#FLAG_ACTIVITY_NEW_TASK" class="headerlink" title="FLAG_ACTIVITY_NEW_TASK"></a>FLAG_ACTIVITY_NEW_TASK</h3><p>这个标记位的作用是为Activity指定 “singleTask” 启动模式，其效果和XML中指定该启动模式相同。</p>
<h3 id="FLAG_ACTIVITY_SINGLE_TOP"><a href="#FLAG_ACTIVITY_SINGLE_TOP" class="headerlink" title="FLAG_ACTIVITY_SINGLE_TOP"></a>FLAG_ACTIVITY_SINGLE_TOP</h3><p>这个标记位的作用是为Activity指定 “singleTop”启动模式，其效果和XML中指定该启动模式相同。</p>
<h3 id="FLAG_ACTIVITY_CLEAR_TOP"><a href="#FLAG_ACTIVITY_CLEAR_TOP" class="headerlink" title="FLAG_ACTIVITY_CLEAR_TOP"></a>FLAG_ACTIVITY_CLEAR_TOP</h3><p>具有此标记位的Activity，当它启动时，在同一个任务栈中所有位于它上面的Activity都要出栈。这个模式一般需要和FLAG_ACTIVITY_NEW_TASK配合使用，在这种情况下，被启动的Activity实例如何已经存在，那么系统会调用它的onNewIntent。如果被启动的Activity采用standard模式启动，那么它连同它之上的Activity都要出栈，系统会创建新的Activity实例并放入栈顶。singleTask启动模式默认具有此标记位的效果</p>
<h2 id="u4E09_u3001IntentFilter_u7684_u5339_u914D_u89C4_u5219"><a href="#u4E09_u3001IntentFilter_u7684_u5339_u914D_u89C4_u5219" class="headerlink" title="三、IntentFilter的匹配规则"></a>三、IntentFilter的匹配规则</h2><p>我们知道，启动Activity分为两种，显示调用和隐式调用。原则上一个Intent不应该即使显示调用又是隐式调用，如果两者共存的话以显示调用为主。显示调用很简单，这里主要介绍隐式调用。隐式调用需要Intent能够匹配目标组件的IntentFileter中所设置的过滤信息，如果不匹配将无法启动目标Activity。IntentFilter中的过滤信息有action、category、data。</p>
<h3 id="action_u5339_u914D_u89C4_u5219"><a href="#action_u5339_u914D_u89C4_u5219" class="headerlink" title="action匹配规则"></a>action匹配规则</h3><p>action是一个字符串，系统预定义一些action，同事我们也可以在应用中定义自己的action。action匹配规则是intent中的action必须能够和过滤规则中的action匹配，这里所的匹配是指action的字符串值完全一样。一个过滤规则中可以有多个action，那么只要Intent中的action‘能够和过滤规则中的任何一个action相同即可匹配成功。</p>
<h3 id="category_u7684_u5339_u914D_u89C4_u5219"><a href="#category_u7684_u5339_u914D_u89C4_u5219" class="headerlink" title="category的匹配规则"></a>category的匹配规则</h3><p>category是一个字符串，系统预定义了一些category同时我们也可以自定义自己的category。category的匹配规则和action不同，Intent可以不指定category，如果指定了category，那么不管指定了几个category都必须要在过滤规则中的能找到相应的category。为什么Intent可以不指定category呢？原因是系统在调用startActivity或者startActivityForResult的时候会默认为Intent加上 “android.intent.category.DEFAULT” 这个category，所以为了我们的Activit能够被隐式调用，就必须在intent-filter过滤规则中指定 “android.intent.category.DEFAULT” 这个category。</p>
<h3 id="data_u7684_u5339_u914D_u89C4_u5219"><a href="#data_u7684_u5339_u914D_u89C4_u5219" class="headerlink" title="data的匹配规则"></a>data的匹配规则</h3><p>data的匹配规则和action类似，如果过滤规则中定义了data，那么Intent中必须也要定义可匹配的data。在介绍data的匹配规则之前，我们需要先了解下data的结构，因为data稍微有点复杂。</p>
<h4 id="data_u7684_u8BED_u6CD5"><a href="#data_u7684_u8BED_u6CD5" class="headerlink" title="data的语法"></a>data的语法</h4><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="typedef"><span class="keyword">data</span> </span></span><br><span class="line">	android:scheme=<span class="string">"string"</span></span><br><span class="line">	android:host=<span class="string">"string"</span></span><br><span class="line">	android:port=<span class="string">"string"</span></span><br><span class="line">	android:path=<span class="string">"string"</span></span><br><span class="line">	android:pathPattern=<span class="string">"string"</span></span><br><span class="line">	android:pathPrefix=<span class="string">"string"</span></span><br><span class="line">	android:mimeType=<span class="string">"string"</span></span><br></pre></td></tr></table></figure>
<p>data由两个部分组成，mimeType和URI。mimeType指媒体类型，比如image/jpeg、video/*等，可以表示图片、文本、视频等不同的媒体格式，而URI中包含的数据就比较多了，下面是URI的结构</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;scheme&gt;<span class="symbol">://&lt;host&gt;</span><span class="symbol">:&lt;port&gt;/</span>[&lt;path&gt;|&lt;pathPrefix&gt;|&lt;pathPattern&gt;]</span><br></pre></td></tr></table></figure>
<ul>
<li>Scheme:URI的模式，比如http、file、content等，如果URI中没有指定scheme，那么整个URI的其他参数无效，这也意味着URI是无效的</li>
<li>Host：URI的主机名，比如www.baidu.com，如果host没有指定，那么整个URI的其他参数无效，这也意味着URI是无效的</li>
<li>Port：URI中的端口号，比如80，仅当URI中指定scheme和host参数的时候port参数才是有意义的</li>
<li>path、pathPattern和pathPrefix：这三个参数表述路径信息，其中path表示完整的路径信息；pathPattern也表示完整的路径信息，但是它里面可以包含通配符 ‘*‘ ，’*‘ 表示0个或者多个任意字符，需要注意的是，由于正则表达式规范的要求，如果想表达真实字符串，那么 ‘*‘ 要写成 ‘\\*‘,’\‘要写成 ‘\\‘；pathPrefix表示路径的前缀信息</li>
</ul>
<h4 id="data_u7684_u8FC7_u6EE4_u89C4_u5219"><a href="#data_u7684_u8FC7_u6EE4_u89C4_u5219" class="headerlink" title="data的过滤规则"></a>data的过滤规则</h4><p>有如下过滤规则</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">data</span> <span class="attribute">android:mimeType</span>=<span class="value">"image/*"</span> /&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这种规则指定了媒体类型为所有类型的图片，那么Intent中的mimeType属性必须为 “image/*”才能匹配，这种情况下过滤规则虽然没有指定URI，但是却有默认值，URI默认值为content何file。也就是说，虽然没有指定URI，但是Intent中的URI部分的scheme必须为content或者file才能匹配。为了匹配上面的过滤规则，我们可以写出如下示例：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">intent.setDataAndType(<span class="built_in">Uri</span>.parse(<span class="string">"file://abc"</span>),<span class="string">"image/png"</span>);</span><br></pre></td></tr></table></figure>
<p>另外，如果要为Intent指定完整的data，必须调用setDataAndType方法，不能先调用setData在调用setType，因为这两个方法彼此会清楚对方的值，setData会吧mimeType置为null，同理setType也会把URI置为null</p>
<p>有如下过滤规则</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">data</span> <span class="attribute">android:mimeType</span>=<span class="value">"video/mpeg"</span> <span class="attribute">android:scheme</span>=<span class="value">"http"</span> <span class="attribute">...</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">data</span> <span class="attribute">android:mimeType</span>=<span class="value">"audio/mpeg"</span> <span class="attribute">android:scheme</span>=<span class="value">"http"</span> <span class="attribute">...</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这种规则指定了两组data规则，且每个data都指定了完整的属性值，既有URI又有mimeType。为了匹配上面的规则，我们可以写出如下示例:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">intent.setDataAndType(<span class="built_in">Uri</span>.parse(<span class="string">"http://abc"</span>),<span class="string">"video/mpeng"</span>);</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">intent.setDataAndType(<span class="built_in">Uri</span>.parse(<span class="string">"http://abc"</span>),<span class="string">"audio/mpeng"</span>);</span><br></pre></td></tr></table></figure>
<p>通过上面示例，读者应该明白了data的匹配规则，关于data还有一个特殊情况需要说明，这也是和action不同的地方，如下两组特殊写法，它们是一样的：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">data</span>  <span class="attribute">android:scheme</span>=<span class="value">"file"</span> <span class="attribute">android:host</span>=<span class="value">"www.baidu.com"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">data</span>  <span class="attribute">android:scheme</span>=<span class="value">"file"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">data</span> <span class="attribute">android:host</span>=<span class="value">"www.baidu.com"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="u6700_u540E"><a href="#u6700_u540E" class="headerlink" title="最后"></a>最后</h3><p>当我们隐式启动Activity的时候，可以做下判断，看是否有Activity能够匹配我们的隐式Intent，如果不做判断就有可能出现 ActivityNotFoundException。判断有两种：采用PackageManager的resolveActivity或者Intent的resolveActivity方法，如果它们找不到匹配的Activity就会返回null，它们通过判断返回值就可以避免上述异常。另外PackageManager还提供了queryIntentActivity方法，这个方法和resolveActivity方法不同：他不是返回最佳匹配的Activity信息而是返回所有成功匹配的Activity信息</p>
</div>

            
<nav class="post-nav flex-row">
  <div class="flex-col waves-block prev">
    
      <a href="/2016/03/03/2016030311_android_floating_action_button_part1/" title="第三方控件 android floating action button 解析 (part1) - FloatingActionButton" id="post-prev" class="post-nav-link">
        <i class="icon icon-chevron-left"></i>
        <span class="article-nav-title">上一篇</span>
      </a>
    
  </div>
  <div class="flex-col waves-block next">
    
      <a href="/2016/02/16/2016021615_Android本地存储器/" title="Android 文件存储" id="post-next" class="post-nav-link">
        <span class="article-nav-title">下一篇</span>
        <i class="icon icon-chevron-right"></i>
      </a>
    
  </div>

</nav>



            




        </div>

      </div>

    

  </article>



    </div>
  </main>
<div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-circle-light"><span class="icon icon-lg icon-chevron-up"></span></a>
<div class="global-share" id="global-share" data-title="Activity的启动模式和匹配规则" data-pic="/img/logo.jpeg" data-summary="&lt;p&gt;&lt;strong&gt;博文内容来自《Android开发艺术探索》第一章Activity的生命周期和启动模式。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Activity是四大组件中我们接触的最多的一个组件，它非常的重要，所以有必要搞清楚他的启动模式和匹配规则&lt;/p&gt;" data-url="http://yoursite.com/2016/02/27/2016022717_Activity的启动模式和匹配规则/index.html">
    <div class="tit">分享到：</div>
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" href="javascript:;" data-title="微博" data-service="tsina">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns" href="javascript:;" data-title="微信" data-service="weixin">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" href="javascript:;" data-title=" QQ" data-service="cqq">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" href="javascript:;" data-title=" Facebook" data-service="fb">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" href="javascript:;" data-title=" Twitter" data-service="twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="douban share-sns" href="javascript:;" data-title="豆瓣" data-service="douban">
          豆
        </a>
      </li>
    </ul>
 </div>


<script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script src="/js/main.js" type="text/javascript"></script>




<script type="text/javascript">
var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cspan id='cnzz_stat_icon_1257735577' style='display:none' %3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1257735577%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));
</script>






</body>
</html>
